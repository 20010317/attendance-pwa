<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å‹¤æ€ ç®¡ç†ã‚¢ãƒ—ãƒª</title>
<script src="https://www.gstatic.com/charts/loader.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Roboto', sans-serif; background: #f0f2f5; margin:0; padding:10px; }

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.header-card {
  background: linear-gradient(135deg,#2196F3,#64B5F6);
  color:white; border-radius:15px; padding:15px; margin-bottom:15px; text-align:center;
  box-shadow:0 6px 12px rgba(0,0,0,0.1);
}
.header-card h1 {margin:0; font-size:22px; font-weight:700;}
.header-card p {margin:5px 0 0 0; font-size:16px; font-weight:500;}

/* ãƒœã‚¿ãƒ³ */
.button-grid { display:grid; grid-template-columns: repeat(2, 1fr); gap:15px; margin-bottom:20px; }
button { font-size:18px; font-weight:500; padding:20px; border:none; border-radius:50px; color:white; cursor:pointer;
         transition: transform 0.15s, filter 0.15s, box-shadow 0.2s; box-shadow:0 4px 6px rgba(0,0,0,0.15);}
button:active { transform: scale(0.95); filter: brightness(1.1); box-shadow:0 2px 3px rgba(0,0,0,0.2);}
.green {background: linear-gradient(135deg,#4CAF50,#81C784);}
.red {background: linear-gradient(135deg,#F44336,#E57373);}
.orange {background: linear-gradient(135deg,#FF9800,#FFB74D);}
.blue {background: linear-gradient(135deg,#2196F3,#64B5F6);}

/* ã‚«ãƒ¼ãƒ‰ */
.card { background:white; border-radius:15px; padding:20px; margin:10px 0;
        box-shadow:0 6px 12px rgba(0,0,0,0.08); opacity:0; transform:translateY(15px);
        transition: all 0.5s ease;}
.card.visible {opacity:1; transform:translateY(0);}
.status p {margin:6px 0; font-size:16px; line-height:1.4;}

/* ãƒˆãƒ¼ã‚¹ãƒˆ */
#toast { position: fixed; bottom:20px; left:50%; transform:translateX(-50%);
        background: rgba(0,0,0,0.75); color:white; padding:12px 25px; border-radius:25px;
        opacity:0; transition: opacity 0.4s; font-weight:500;}
</style>
</head>
<body>

<div class="header-card">
  <h1>æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«</h1>
  <p>å±±ç”° å¤ªéƒ / ç¤¾å“¡ç•ªå·: 12345</p>
</div>

<div class="button-grid">
  <button class="green" onclick="post('å‡ºå‹¤')">ğŸŸ¢ å‡ºå‹¤</button>
  <button class="red" onclick="post('é€€å‹¤')">ğŸ”´ é€€å‹¤</button>
  <button class="orange" onclick="post('å¤–å‡º')">ğŸŸ  å¤–å‡º</button>
  <button class="blue" onclick="post('æˆ»ã‚Š')">ğŸ”µ æˆ»ã‚Š</button>
</div>

<div class="card status" id="todayCard">
<h3>ä»Šæ—¥ã®å‹¤å‹™çŠ¶æ³</h3>
<p id="todayStatus">èª­ã¿è¾¼ã¿ä¸­...</p>
</div>

<div class="card status" id="monthCard">
<h3>æœˆæ¬¡ã‚µãƒãƒªãƒ¼</h3>
<p id="monthSummary">èª­ã¿è¾¼ã¿ä¸­...</p>
</div>

<div class="card" id="chartCard">
<div id="chart_div" style="width:100%; height:300px;"></div>
</div>

<div id="toast"></div>

<script>
const WEBAPP_URL = 'ã€ã“ã“ã«Webã‚¢ãƒ—ãƒªURLã€‘';

function showToast(msg){
  const toast = document.getElementById('toast');
  toast.innerText = msg; toast.style.opacity = 1;
  setTimeout(()=>{ toast.style.opacity=0; }, 1500);
}

function post(type){
  fetch(WEBAPP_URL, { method:'POST', body: JSON.stringify({type:type}) })
  .then(r=>r.json()).then(d=>{ showToast(d.status+(d.message?': '+d.message:'')); loadStatus(); })
  .catch(e=>{ showToast('é€šä¿¡ã‚¨ãƒ©ãƒ¼'); });
}

function loadStatus(){
  fetch(WEBAPP_URL+'?type=status')
  .then(r=>r.json()).then(d=>{
    const todayText =
      `å‡ºå‹¤: ${d.checkIn}\né€€å‹¤: ${d.checkOut}\nå®ŸåŠ´åƒ: ${d.work}\næ®‹æ¥­: ${d.overtime}\nå¤–å‡º: ${d.break}\næ·±å¤œ: ${d.midnight}`;
    document.getElementById('todayStatus').innerText = todayText;
    document.getElementById('todayCard').classList.add('visible');

    const monthText =
      `å‡ºå‹¤æ—¥æ•°: ${d.days}\nåŠ´åƒåˆè¨ˆ: ${d.totalWork}\næ®‹æ¥­åˆè¨ˆ: ${d.totalOvertime}\næ·±å¤œåˆè¨ˆ: ${d.totalMidnight}\nå¤–å‡ºåˆè¨ˆ: ${d.totalBreak}`;
    document.getElementById('monthSummary').innerText = monthText;
    document.getElementById('monthCard').classList.add('visible');

    drawChart(d);
  });
}

google.charts.load('current', {'packages':['corechart']});
function drawChart(d){
  var data = google.visualization.arrayToDataTable([
    ['é …ç›®','æ™‚é–“',{ role: 'style' }],
    ['åŠ´åƒ', d.work||0, 'color:rgba(76,175,80,0.8)'],
    ['æ®‹æ¥­', d.overtime||0, 'color:rgba(244,67,54,0.8)'],
    ['æ·±å¤œ', d.midnight||0, 'color:rgba(33,150,243,0.8)'],
    ['å¤–å‡º', d.break||0, 'color:rgba(255,152,0,0.8)']
  ]);
  var options = { title:'æœˆæ¬¡å‹¤æ€ ã‚°ãƒ©ãƒ•', legend:{position:'bottom'}, animation:{startup:true,duration:600,easing:'out'}};
  var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
  chart.draw(data, options);
}
google.charts.setOnLoadCallback(loadStatus);

if('serviceWorker' in navigator){ navigator.serviceWorker.register('service-worker.js'); }

let deferredPrompt;
window.addEventListener('beforeinstallprompt', e=>{
  e.preventDefault(); deferredPrompt=e;
  const btn=document.createElement('button');
  btn.innerText="ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ";
  btn.style.position="fixed"; btn.style.bottom="20px"; btn.style.left="50%"; btn.style.transform="translateX(-50%)";
  btn.style.padding="12px 20px"; btn.style.borderRadius="20px"; btn.style.background="#2196F3"; btn.style.color="white";
  btn.style.fontWeight="500"; btn.style.zIndex="1000";
  btn.onclick=()=>{ deferredPrompt.prompt(); deferredPrompt.userChoice.then(()=>{ deferredPrompt=null; btn.remove(); }); };
  document.body.appendChild(btn);
});
</script>
</body>
</html>