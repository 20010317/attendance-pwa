<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/charts/loader.js"></script>
<style>
/* å…¨ä½“ */
body {
  font-family: 'Roboto', sans-serif;
  background: #FFFFFF;
  margin:0; padding:0 0 60px 0;
  color:#2C3E50;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.header {
  background:#003366; /* ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ–ãƒ«ãƒ¼ */
  color:white; border-radius:0 0 12px 12px;
  padding:15px 20px; text-align:left;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  display:flex; flex-direction:column; align-items:flex-start;
}
.header-date { font-size:18px; margin-bottom:8px; font-weight:500; }
.header-clock { font-family:'Orbitron','Courier New',monospace; font-size:48px; letter-spacing:2px; line-height:1; }
.header-clock span.sec { font-size:28px; }
.header-last { font-size:14px; margin-top:8px; display:flex; align-items:center; gap:10px; }
.header-last button { background:#E74C3C; color:white; border:none; border-radius:8px; padding:4px 8px; cursor:pointer; font-size:12px; transition:0.15s; }
.header-last button:active { transform:scale(0.95); }

/* æ‰“åˆ»ãƒœã‚¿ãƒ³ 2x2 */
.button-grid {
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:15px;
  margin:20px 15px;
}
button.action-btn {
  font-size:16px; font-weight:500; padding:20px; border-radius:12px;
  display:flex; align-items:center; justify-content:center; gap:8px;
  cursor:pointer; transition:0.15s; box-shadow:0 4px 8px rgba(0,0,0,0.08);
}
button.action-btn:active { transform:scale(0.97); }

/* è‰²åˆ†ã‘ */
.btn-start { background:#003366; color:white; }       /* å‹¤å‹™é–‹å§‹ */
.btn-end   { background:#003366; color:white; }       /* å‹¤å‹™çµ‚äº† */
.btn-break { background:white; color:#003366; border:2px solid #003366; }  /* ä¼‘æ†©é–‹å§‹ */
.btn-return{ background:white; color:#003366; border:2px solid #003366; }  /* ä¼‘æ†©çµ‚äº† */

/* å…¥åŠ›ãƒ»æƒ…å ±ã‚¨ãƒªã‚¢ */
.info-section {
  margin:15px; display:flex; flex-direction:column; gap:15px;
}

/* ãƒ¡ãƒ¢æ¬„ */
.memo-input {
  width:100%; padding:10px; border-radius:8px; border:1px solid #BDC3C7;
  font-size:14px; resize:none; min-height:50px;
}

/* å‹¤å‹™çŠ¶æ³ã‚µãƒãƒªãƒ¼ */
.summary-card {
  background:#F0F0F0; border-radius:12px; padding:15px; display:flex; flex-direction:column; gap:10px;
}
.summary-title { font-weight:500; font-size:16px; margin-bottom:5px; }
.summary-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(100px,1fr)); gap:10px; }
.summary-field {
  background:white; border-radius:8px; padding:10px; text-align:center; font-size:14px;
}

/* ã‚°ãƒ©ãƒ•ã‚«ãƒ¼ãƒ‰ */
.chart-card { background:white; border-radius:12px; padding:15px; margin:0 15px 15px 15px; box-shadow:0 4px 8px rgba(0,0,0,0.08); }
#chart_div { width:100%; height:250px; }

/* ä¸‹éƒ¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ */
.footer-bar {
  position:fixed; bottom:0; left:0; width:100%;
  background:#34495E; color:white; font-size:14px; font-weight:500;
  text-align:center; padding:10px 0; box-shadow:0 -3px 6px rgba(0,0,0,0.1);
}

/* ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ */
#toast {
  position:fixed; bottom:70px; left:50%; transform:translateX(-50%);
  background: rgba(0,0,0,0.7); color:white; padding:10px 25px; border-radius:25px;
  opacity:0; transition:0.4s; font-weight:500; z-index:1000;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
@media(max-width:600px){
  .header-clock { font-size:36px; }
  .header-clock span.sec { font-size:20px; }
  button.action-btn { font-size:14px; padding:16px; }
  .summary-field { font-size:12px; }
}
</style>
</head>
<body>

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<div class="header">
  <div class="header-date" id="dateDisplay">----/--/-- (---)</div>
  <div class="header-clock" id="digitalClock">--:--<span class="sec">--</span></div>
  <div class="header-last">
    <span id="lastStamp">ç›´å‰ã®æ‰“åˆ»ï¼š[å‹¤å‹™é–‹å§‹] ----/-- --:--</span>
    <button onclick="cancelLast()">æ‰“åˆ»å–æ¶ˆ</button>
  </div>
</div>

<!-- æ‰“åˆ»ãƒœã‚¿ãƒ³ 2x2 -->
<div class="button-grid">
  <button class="action-btn btn-start" onclick="post('å‹¤å‹™é–‹å§‹')">ğŸŸ¢ å‹¤å‹™é–‹å§‹</button>
  <button class="action-btn btn-end" onclick="post('å‹¤å‹™çµ‚äº†')">ğŸ”´ å‹¤å‹™çµ‚äº†</button>
  <button class="action-btn btn-break" onclick="post('ä¼‘æ†©é–‹å§‹')">â³ ä¼‘æ†©é–‹å§‹</button>
  <button class="action-btn btn-return" onclick="post('ä¼‘æ†©çµ‚äº†')">â³ ä¼‘æ†©çµ‚äº†</button>
</div>

<!-- å…¥åŠ›ãƒ»æƒ…å ±ã‚¨ãƒªã‚¢ -->
<div class="info-section">
  <textarea class="memo-input" placeholder="ãƒ¡ãƒ¢ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea>

  <div class="summary-card">
    <div class="summary-title">ã‚¿ã‚¤ãƒ ã‚«ãƒ¼ãƒ‰å…¥åŠ›</div>
    <div class="summary-grid">
      <div class="summary-field" id="planned">å‡ºå‹¤äºˆå®šï¼š--:-----:--<br>æ‰€å®šæ™‚é–“æ•°ï¼š--:--</div>
      <div class="summary-field" id="startTime">é–‹å§‹æ™‚åˆ»ï¼š--:--</div>
      <div class="summary-field" id="endTime">çµ‚äº†æ™‚åˆ»ï¼š--:--</div>
      <div class="summary-field" id="breakTime">ä¼‘æ†©æ™‚é–“æ•°ï¼š--:--</div>
      <div class="summary-field" id="workTime">å‹¤å‹™æ™‚é–“æ•°ï¼š--:--</div>
    </div>
  </div>
</div>

<!-- ã‚°ãƒ©ãƒ•ã‚«ãƒ¼ãƒ‰ -->
<div class="chart-card">
  <div id="chart_div"></div>
</div>

<!-- ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ -->
<div id="toast"></div>

<!-- ä¸‹éƒ¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
<div class="footer-bar" id="footerStatus">å‹¤å‹™ 0h | æ®‹æ¥­ 0h | å¤–å‡º 0h</div>

<script>
const WEBAPP_URL = 'ã€ã“ã“ã«Webã‚¢ãƒ—ãƒªURLã€‘';

function showToast(msg){
  const toast=document.getElementById('toast');
  toast.innerText=msg; toast.style.opacity=1;
  setTimeout(()=>{ toast.style.opacity=0; },1500);
}

// æ‰“åˆ»ãƒœã‚¿ãƒ³é€ä¿¡
function post(type){
  fetch(WEBAPP_URL, { method:'POST', body: JSON.stringify({type:type}) })
  .then(r=>r.json()).then(d=>{
    showToast(d.status+(d.message?': '+d.message:''));
    loadStatus();
  }).catch(()=>showToast('é€šä¿¡ã‚¨ãƒ©ãƒ¼'));
}

// æ‰“åˆ»å–æ¶ˆï¼ˆæœ€å¾Œã®æ‰“åˆ»ï¼‰
function cancelLast(){
  fetch(WEBAPP_URL+'?type=cancel', { method:'POST' })
  .then(r=>r.json()).then(d=>{
    showToast(d.status);
    loadStatus();
  }).catch(()=>showToast('é€šä¿¡ã‚¨ãƒ©ãƒ¼'));
}

// å‹¤å‹™çŠ¶æ³èª­ã¿è¾¼ã¿
function loadStatus(){
  fetch(WEBAPP_URL+'?type=status')
  .then(r=>r.json()).then(d=>{
    // ã‚¿ã‚¤ãƒ ã‚«ãƒ¼ãƒ‰æƒ…å ±
    document.getElementById('lastStamp').innerText=`ç›´å‰ã®æ‰“åˆ»ï¼š[${d.lastType||''}] ${d.lastTime||''}`;
    document.getElementById('planned').innerHTML=`å‡ºå‹¤äºˆå®šï¼š${d.plannedIn||'--:--'}-${d.plannedOut||'--:--'}<br>æ‰€å®šæ™‚é–“æ•°ï¼š${d.standard||'--:--'}`;
    document.getElementById('startTime').innerText=`é–‹å§‹æ™‚åˆ»ï¼š${d.checkIn||'--:--'}`;
    document.getElementById('endTime').innerText=`çµ‚äº†æ™‚åˆ»ï¼š${d.checkOut||'--:--'}`;
    document.getElementById('breakTime').innerText=`ä¼‘æ†©æ™‚é–“æ•°ï¼š${d.break||'--:--'}`;
    document.getElementById('workTime').innerText=`å‹¤å‹™æ™‚é–“æ•°ï¼š${d.work||'--:--'}`;

    // ä¸‹éƒ¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
    document.getElementById('footerStatus').innerText=
      `å‹¤å‹™ ${d.work||0}h | æ®‹æ¥­ ${d.overtime||0}h | å¤–å‡º ${d.break||0}h`;

    // ã‚°ãƒ©ãƒ•æç”»
    drawChart(d);
  });
}

// ãƒ‡ã‚¸ã‚¿ãƒ«æ™‚è¨ˆ
function updateDateTime(){
  const now=new Date();
  const year=now.getFullYear();
  const month=(now.getMonth()+1).toString().padStart(2,'0');
  const day=now.getDate().toString().padStart(2,'0');
  const weekdays=['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
  const weekday=weekdays[now.getDay()];
  document.getElementById('dateDisplay').innerText=`${year}/${month}/${day} (${weekday})`;

  const h=now.getHours().toString().padStart(2,'0');
  const m=now.getMinutes().toString().padStart(2,'0');
  const s=now.getSeconds().toString().padStart(2,'0');
  document.getElementById('digitalClock').innerHTML=`${h}:${m}<span class="sec">${s}</span>`;
}
setInterval(updateDateTime,1000);
updateDateTime();

// ã‚°ãƒ©ãƒ•
google.charts.load('current', {'packages':['corechart']});
function drawChart(d){
  const data=google.visualization.arrayToDataTable([
    ['é …ç›®','æ™‚é–“',{role:'style'}],
    ['åŠ´åƒ', d.work||0, 'color:#003366'],
    ['æ®‹æ¥­', d.overtime||0, 'color:#E74C3C'],
    ['ä¼‘æ†©', d.break||0, 'color:#F39C12'],
    ['æ·±å¤œ', d.midnight||0, 'color:#9B59B6']
  ]);
  const options={title:'æœˆæ¬¡å‹¤æ€ ã‚°ãƒ©ãƒ•', legend:{position:'bottom'}, animation:{startup:true,duration:600,easing:'out'}};
  const chart=new google.visualization.ColumnChart(document.getElementById('chart_div'));
  chart.draw(data, options);
}
google.charts.setOnLoadCallback(loadStatus);
</script>
</body>
</html>