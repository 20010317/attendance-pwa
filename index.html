<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>勤怠管理システム</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/charts/loader.js"></script>
<style>
body { font-family:'Roboto',sans-serif; background:#fff; margin:0; padding:0 0 60px 0; color:#2C3E50; }
/* ヘッダー */
.header-top { background:#ECEFF1; padding:10px 20px; display:flex; flex-direction:column; align-items:flex-start; border-bottom:1px solid #B0BEC5; }
.header-company { font-size:22px; font-weight:700; margin-bottom:2px; }
.header-employee { font-size:16px; margin-bottom:4px; }
.header-bottom { background:#003366; color:white; border-radius:0 0 12px 12px; padding:15px 20px; box-shadow:0 4px 12px rgba(0,0,0,0.15); display:flex; flex-direction:column; align-items:flex-start; }
.header-clock { font-family:'Orbitron','Courier New',monospace; font-size:48px; letter-spacing:2px; line-height:1; }
.header-clock span.sec { font-size:28px; }
.header-date { font-size:18px; font-weight:500; margin-bottom:8px; } 
.header-last { font-size:14px; margin-top:8px; display:flex; align-items:center; gap:10px; }
.header-last button { background:#E74C3C; color:white; border:none; border-radius:8px; padding:4px 8px; cursor:pointer; font-size:12px; transition:0.15s; }
.header-last button:active { transform:scale(0.95); }

/* 打刻ボタン */
.button-grid { display:grid; grid-template-columns: repeat(2, 1fr); gap:15px; margin:20px 15px; }
button.action-btn { font-size:16px; font-weight:500; padding:20px; border-radius:12px; cursor:pointer; transition:0.15s; box-shadow:0 4px 8px rgba(0,0,0,0.08); }
button.action-btn:active { transform:scale(0.97); }
.btn-start { background:#003366; color:white; }       
.btn-end   { background:#003366; color:white; }       
.btn-break { background:white; color:#003366; border:2px solid #003366; }  
.btn-return{ background:white; color:#003366; border:2px solid #003366; }  
.btn-out   { background:white; color:#003366; border:2px solid #003366; }  
.btn-back  { background:white; color:#003366; border:2px solid #003366; }  

/* 入力・情報エリア */
.info-section { margin:15px; display:flex; flex-direction:column; gap:10px; }
.memo-input { width:100%; padding:10px; border-radius:8px; border:1px solid #BDC3C7; font-size:14px; resize:none; min-height:50px; }
.summary-card { background:#F0F0F0; border-radius:12px; padding:15px; display:flex; flex-direction:column; gap:10px; margin-bottom:0; }
.summary-title { font-weight:500; font-size:16px; margin-bottom:5px; }
.summary-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(100px,1fr)); gap:10px; }
.summary-field { background:white; border-radius:8px; padding:10px; text-align:center; font-size:14px; }

/* 勤務時間バー */
.timebar-card { background:#ECEFF1; border-radius:12px; padding:10px; margin:0 15px 15px 15px; display:flex; flex-direction:column; gap:6px; }
.timebar-title { font-weight:500; font-size:16px; margin-bottom:5px; }
.timebar-container { position:relative; height:24px; background:#CFD8DC; border-radius:12px; overflow:hidden; }
.timebar-segment { position:absolute; top:0; height:100%; }

/* 色分け */
.bar-work { background:#003366; }       
.bar-break { background:#F39C12; }      
.bar-overtime { background:#E74C3C; }   
.bar-out { background:#9E9E9E; }        

/* グラフカード */
.chart-card { background:white; border-radius:12px; padding:15px; margin:0 15px 15px 15px; box-shadow:0 4px 8px rgba(0,0,0,0.08); }
#chart_div { width:100%; height:250px; }

/* 下部ステータスバー */
.footer-bar { position:fixed; bottom:0; left:0; width:100%; background:#34495E; color:white; font-size:14px; font-weight:500; text-align:center; padding:10px 0; box-shadow:0 -3px 6px rgba(0,0,0,0.1); }

/* トースト通知 */
#toast { position:fixed; bottom:70px; left:50%; transform:translateX(-50%); background: rgba(0,0,0,0.7); color:white; padding:10px 25px; border-radius:25px; opacity:0; transition:0.4s; font-weight:500; z-index:1000; }

/* カスタムツールチップ */
.tooltip { position:absolute; background: rgba(0,0,0,0.8); color:#fff; padding:4px 8px; border-radius:6px; font-size:12px; pointer-events:none; opacity:0; transition:0.3s; z-index:1000; }

@media(max-width:600px){ .header-clock { font-size:36px; } .header-clock span.sec { font-size:20px; } button.action-btn { font-size:14px; padding:16px; } .summary-field { font-size:12px; } .header-company { font-size:18px; } .header-employee { font-size:14px; } .header-date { font-size:16px; } }
</style>
</head>
<body>

<div class="header-top">
  <div class="header-company" id="companyName">株式会社サンプル</div>
  <div class="header-employee" id="employeeInfo">山田 太郎 / 社員番号:12345</div>
</div>
<div class="header-bottom">
  <div class="header-clock" id="digitalClock">--:--<span class="sec">--</span></div>
  <div class="header-date" id="dateDisplay">----/--/-- (---)</div>
  <div class="header-last">
    <span id="lastStamp">直前の打刻：[勤務開始] ----/-- --:--</span>
    <button onclick="cancelLast()">打刻取消</button>
  </div>
</div>

<div class="button-grid">
  <button class="action-btn btn-start" onclick="post('勤務開始')">勤務開始</button>
  <button class="action-btn btn-end" onclick="post('勤務終了')">勤務終了</button>
  <button class="action-btn btn-break" onclick="post('休憩開始')">休憩開始</button>
  <button class="action-btn btn-return" onclick="post('休憩終了')">休憩終了</button>
  <button class="action-btn btn-out" onclick="post('外出')">外出</button>
  <button class="action-btn btn-back" onclick="post('戻り')">戻り</button>
</div>

<div class="info-section">
  <textarea class="memo-input" placeholder="メモを記入してください"></textarea>

  <div class="summary-card">
    <div class="summary-title">タイムカード入力</div>
    <div class="summary-grid">
      <div class="summary-field" id="planned">出勤予定：--:-- - --:--<br>所定時間数：--:--</div>
      <div class="summary-field" id="startTime">開始時刻：--:--</div>
      <div class="summary-field" id="endTime">終了時刻：--:--</div>
      <div class="summary-field" id="breakTime">休憩時間数：--:--</div>
      <div class="summary-field" id="workTime">勤務時間数：--:--</div>
    </div>
  </div>

  <div class="timebar-card">
    <div class="timebar-title">勤務時間の可視化</div>
    <div class="timebar-container" id="timeBar"></div>
  </div>
</div>

<div class="chart-card">
  <div id="chart_div"></div>
</div>

<div id="toast"></div>
<div class="footer-bar" id="footerStatus">勤務 0h | 残業 0h | 外出 0h</div>
<div id="tooltip" class="tooltip"></div>

<script>
const WEBAPP_URL = '【ここにWebアプリURL】';

function showToast(msg){
  const toast=document.getElementById('toast'); toast.innerText=msg; toast.style.opacity=1;
  setTimeout(()=>{ toast.style.opacity=0; },1500);
}

function post(type){
  fetch(WEBAPP_URL, { method:'POST', body: JSON.stringify({type:type}) })
  .then(r=>r.json()).then(d=>{ showToast(d.status+(d.message?': '+d.message:'')); loadStatus(); }).catch(()=>showToast('通信エラー'));
}

function cancelLast(){
  fetch(WEBAPP_URL+'?type=cancel', { method:'POST' })
  .then(r=>r.json()).then(d=>{ showToast(d.status); loadStatus(); }).catch(()=>showToast('通信エラー'));
}

// デジタル時計
function updateDateTime(){
  const now=new Date();
  const year=now.getFullYear();
  const month=(now.getMonth()+1).toString().padStart(2,'0');
  const day=now.getDate().toString().padStart(2,'0');
  const weekdays=['日','月','火','水','木','金','土'];
  const weekday=weekdays[now.getDay()];
  document.getElementById('dateDisplay').innerText=`${year}/${month}/${day} (${weekday})`;

  const h=now.getHours().toString().padStart(2,'0');
  const m=now.getMinutes().toString().padStart(2,'0');
  const s=now.getSeconds().toString().padStart(2,'0');
  document.getElementById('digitalClock').innerHTML=`${h}:${m}<span class="sec">${s}</span>`;
}
setInterval(updateDateTime,1000);
updateDateTime();

// 勤務状況読み込み
function loadStatus(){
  fetch(WEBAPP_URL+'?type=status')
  .then(r=>r.json()).then(d=>{
    if(d.error){ showToast(d.error); return; }
    document.getElementById('companyName').innerText=d.companyName;
    document.getElementById('employeeInfo').innerText=`${d.employeeName} / 社員番号:${d.employeeNumber}`;
    document.getElementById('lastStamp').innerText=`直前の打刻：[${d.lastType||''}] ${d.lastTime||''}`;
    document.getElementById('planned').innerHTML=`出勤予定：${d.plannedIn||'--:--'}-${d.plannedOut||'--:--'}<br>所定時間数：${d.standard||'--:--'}`;
    document.getElementById('startTime').innerText=`開始時刻：${d.checkIn||'--:--'}`;
    document.getElementById('endTime').innerText=`終了時刻：${d.checkOut||'--:--'}`;
    document.getElementById('breakTime').innerText=`休憩時間数：${d.break||'--:--'}`;
    document.getElementById('workTime').innerText=`勤務時間数：${d.work||'--:--'}`;
    document.getElementById('footerStatus').innerText=
      `勤務 ${d.work||0}h | 残業 ${d.overtime||0}h | 外出 ${d.break||0}h`;
    drawChart(d);
    drawTimeBar(d);
  }).catch(()=>showToast('通信エラー'));
}

// 勤務時間バー
const tooltip = document.getElementById('tooltip');

function drawTimeBar(d){
  const container=document.getElementById('timeBar');
  container.innerHTML='';

  function timeToPercent(t){ 
    if(!t) return 0;
    const [h,m]=t.split(':').map(Number); 
    return (h + m/60)/24*100;
  }

  const segments=[];
  if(d.workStart && d.workEnd) segments.push({start:timeToPercent(d.workStart), end:timeToPercent(d.workEnd), class:'bar-work', label:`勤務 ${d.workStart}-${d.workEnd}`});
  if(d.breaks) d.breaks.forEach(b=>segments.push({start:timeToPercent(b.start), end:timeToPercent(b.end), class:'bar-break', label:`休憩 ${b.start}-${b.end}`}));
  if(d.overtime) d.overtime.forEach(b=>segments.push({start:timeToPercent(b.start), end:timeToPercent(b.end), class:'bar-overtime', label:`残業 ${b.start}-${b.end}`}));
  if(d.out) d.out.forEach(b=>segments.push({start:timeToPercent(b.start), end:timeToPercent(b.end), class:'bar-out', label:`外出 ${b.start}-${b.end}`}));

  segments.forEach(s=>{
    const bar=document.createElement('div');
    bar.className='timebar-segment '+s.class;
    bar.style.left=s.start+'%';
    bar.style.width=(s.end-s.start)+'%';
    bar.dataset.label=s.label;

    bar.addEventListener('mouseenter', showTooltip);
    bar.addEventListener('mouseleave', hideTooltip);
    bar.addEventListener('touchstart', e => { showTooltip(e); setTimeout(hideTooltip,1500); });

    container.appendChild(bar);
  });
}

function showTooltip(e){
  const bar = e.currentTarget;
  tooltip.innerText = bar.dataset.label;
  const rect = bar.getBoundingClientRect();
  tooltip.style.left = rect.left + rect.width/2 - tooltip.offsetWidth/2 + 'px';
  tooltip.style.top = rect.top - tooltip.offsetHeight - 6 + 'px';
  tooltip.style.opacity = 1;
}
function hideTooltip(){ tooltip.style.opacity = 0; }

// 月次グラフ
google.charts.load('current', {'packages':['corechart']});
function drawChart(d){
  const data=google.visualization.arrayToDataTable([
    ['項目','時間',{role:'style'}],
    ['労働', d.work||0, 'color:#003366'],
    ['残業', d.overtime||0, 'color:#E74C3C'],
    ['休憩', d.break||0, 'color:#F39C12'],
    ['外出', d.out?d.out.length:0, 'color:#9E9E9E']
  ]);
  const options={title:'月次勤怠グラフ', legend:{position:'bottom'}, animation:{startup:true,duration:600,easing:'out'}};
  const chart=new google.visualization.ColumnChart(document.getElementById('chart_div'));
  chart.draw(data, options);
}
google.charts.setOnLoadCallback(loadStatus);
</script>
</body>
</html>